@model SWP.Models.ProductDetail

<form asp-action="UpdateDetailProduct" method="post" enctype="multipart/form-data">
    <div class="container mt-3">
        <div class="row">
            <div class="">
                <div class="card">
                    <div class="card-body" style="max-height: 550px; overflow-y: auto;">
                        <h4 class="card-title">Sản phẩm hiện có</h4>
                        <h5 style="color: red;">@ViewData["ErrorMessage"]</h5>
                        <div class="row">
                            @if (ViewBag.AllProductDetails == null || ViewBag.AllProductDetails.Count == 0)
                            {
                               @* <div class="row default-detail-row">
                                    <div class="col-4">
                                        <div class="mb-3">
                                            <label asp-for="ColorId" class="form-label">Màu sắc<span class="required-star">*</span></label>
                                            <select asp-for="ColorId" class="form-control"    name="ColorId" required>
                                                @foreach (var color in ViewBag.Colors)
                                                {
                                                    <option value="@color.ColorId">@color.ColorName</option>
                                                }
                                            </select>
                                            <span asp-validation-for="ColorId" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="mb-3">
                                            <label asp-for="SizeId" class="form-label">Kích thước<span class="required-star">*</span></label>
                                            <select asp-for="SizeId" class="form-control multiselect"  name="SizeId" required>
                                                @foreach (var size in ViewBag.Sizes)
                                                {
                                                    <option value="@size.SizeId">@size.SizeName</option>
                                                }
                                            </select>
                                            <span asp-validation-for="SizeId" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="mb-3">
                                            <label asp-for="Quantity" class="form-label">Số lượng<span class="required-star">*</span></label>
                                          <input name="Quanties" class="form-control" type="number" min="0" required oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/^0+/, '')" pattern="\d+" title="Số lượng phải là số nguyên không âm" />
                                            <span asp-validation-for="Quantity" class="text-danger"></span>
                                        </div>
                                    </div>
                                    
                                </div>*@
                                <h5 class="text-center" style="color:red">Không có dữ liệu</h5>
                            }
                            @foreach (var productDetail in ViewBag.AllProductDetails)
                            {
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label asp-for="ColorId" class="form-label">Màu sắc<span class="required-star">*</span></label>
                                        <select asp-for="ColorId" class="form-control" readonly required>
                                            @foreach (var color in ViewBag.Colors)
                                            {
                                                <option value="@color.ColorId" selected="@(color.ColorId == productDetail.ColorId)">@color.ColorName</option>
                                            }
                                        </select>
                                        <span asp-validation-for="ColorId" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-4">
                                    <div class="mb-3">
                                        <label asp-for="SizeId" class="form-label">Kích thước<span class="required-star">*</span></label>
                                        <select asp-for="SizeId" class="form-control multiselect" readonly required>
                                            @foreach (var size in ViewBag.Sizes)
                                            {
                                                <option value="@size.SizeId" selected="@(size.SizeId == productDetail.SizeId)">@size.SizeName</option>
                                            }
                                        </select>
                                        <span asp-validation-for="SizeId" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-4">
                                    <div class="mb-3">
                                        <label asp-for="Quantity" class="form-label">Số lượng<span class="required-star">*</span></label>
                                        <input name="Quanties" class="form-control" type="text" pattern="\d*" title="Vui lòng chỉ nhập số nguyên không có dấu phẩy hoặc dấu chấm" value="@productDetail.Quantity" readonly required />
                                        <span asp-validation-for="Quantity" class="text-danger"></span>

                                        <!-- Add a hidden field for ProductDetailId -->
                                        <input type="hidden" asp-for="DetailId" value="@productDetail.DetailId" />
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="row">
                            <div class="col-6">
                                @*<div class="mb-3">
                                    <label asp-for="Quantity" class="form-label">Số lượng<span class="required-star">*</span></label>
                                    <input asp-for="Quantity" class="form-control" type="number" min="0" value="@Model?.Quantity" required />
                                    <span asp-validation-for="Quantity" class="text-danger"></span>
                                </div>*@
                            </div>
                        </div>
                        <hr />
                        <h4>Nhập sản phẩm mới</h4>
                       
                        <div class="row default-detail-row">
                        <div class="col-4">
                        <div class="mb-3">
                        <label asp-for="ColorId" class="form-label">Màu sắc<span class="required-star">*</span></label>
                        <select asp-for="ColorId" class="form-control"    name="ColorId" required>
                        @foreach (var color in ViewBag.Colors)
                        {
                        <option value="@color.ColorId">@color.ColorName</option>
                        }
                        </select>
                        <span asp-validation-for="ColorId" class="text-danger"></span>
                        </div>
                        </div>
                        <div class="col-4">
                        <div class="mb-3">
                        <label asp-for="SizeId" class="form-label">Kích thước<span class="required-star">*</span></label>
                        <select asp-for="SizeId" class="form-control multiselect"  name="SizeId" required>
                        @foreach (var size in ViewBag.Sizes)
                        {
                        <option value="@size.SizeId">@size.SizeName</option>
                        }
                        </select>
                        <span asp-validation-for="SizeId" class="text-danger"></span>
                        </div>
                        </div>
                        <div class="col-3">
                        <div class="mb-3">
                        <label asp-for="Quantity" class="form-label">Số lượng<span class="required-star">*</span></label>
                        <input name="Quanties" class="form-control" type="number" min="1" required oninput="this.value = this.value.replace(/[^1-9]/g, '').replace(/^0+/, '')" pattern="\d+" title="Số lượng phải là số nguyên không âm" />
                        <span asp-validation-for="Quantity" class="text-danger"></span>
                        </div>
                        </div>

                        </div>
                        <div class="mb-3 text-end">
                            <button type="button" class="btn btn-primary" onclick="addDetailRow()" title="Thêm ô nhập sản phẩm mới">Thêm trường nhập</button>
                        </div>

                       @* <div class="row">
                            <div class="col-6">
                                <div class="mb-3">
                                    <label asp-for="Feature" class="form-label">Mô tả tính năng</label>
                                    <textarea asp-for="Feature" class="form-control">@Model?.Feature</textarea>
                                    <span asp-validation-for="Feature" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="mb-3">
                                    <label asp-for="Attributes" class="form-label">Mô tả đặc điểm</label>
                                    <textarea asp-for="Attributes" class="form-control">@Model?.Attributes</textarea>
                                    <span asp-validation-for="Attributes" class="text-danger"></span>
                                </div>
                            </div>
                        </div>*@
                      
                    </div>
                      
                </div>
                <div class="mb-3 me-3 mt-3">
                  
                    <input asp-for="ProductId" value="@ViewBag.Product.ProductId" type="hidden" class="form-control" />

                    <div class="mb-2 text-end">
                        <button type="submit" class="btn btn-primary" title="Lưu lại tất cả thông tin trên">Lưu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
      
</form>
 

@section Scripts {
    <script>
        function addDetailRow() {
            var index = $('.detail-row').length; // Get the index for the new row

            var newRow = `<div class="detail-row">
                            <div class="row">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label asp-for="ColorId" class="form-label">Màu sắc<span class="required-star">*</span></label>
                                                        <select asp-for="ColorId" class="form-control"   name="ColorId" required>
        @foreach (var color in ViewBag.Colors)
        {
                                                    <option value="@color.ColorId">@color.ColorName</option>
        }
                                        </select>
                                        <span asp-validation-for="ColorIds" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label asp-for="SizeId" class="form-label">Kích thước<span class="required-star">*</span></label>
                                                                <select asp-for="SizeId" class="form-control multiselect"  name="SizeId" required>
        @foreach (var size in ViewBag.Sizes)
        {
                                                    <option value="@size.SizeId">@size.SizeName</option>
        }
                                        </select>
                                        <span asp-validation-for="SizeIds" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="mb-3">
                                        <label asp-for="Quantity" class="form-label">Số lượng<span class="required-star">*</span></label>
                                                        <input name="Quanties" class="form-control" type="number" oninput="validateInput(this)" title="Vui lòng chỉ nhập số nguyên không có dấu phẩy hoặc dấu chấm" required />

                                                <span asp-validation-for="Quantity" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-1 text-center mt-4">
                                    <button type="button" class="btn btn-danger" onclick="removeDetailRow(this)">Xóa bỏ</button>
                                </div>
                            </div>
                        </div>`;

            // If no data is available, display a default row
             if ($('.detail-row').length === 0) {
        // Insert the new row before the button
        $(newRow).insertBefore('.mb-3.text-end');
    } else {
        // Insert the new row before the button
        $(newRow).insertBefore('.mb-3.text-end');
    }
        }

        // ... (rest of the code remains unchanged)


        function removeDetailRow(button) {
            // Find the parent detail-row and remove it
            $(button).closest('.detail-row').remove();
        }
        function validateInput(input) {
            // Loại bỏ mọi ký tự không phải là số
            input.value = input.value.replace(/[^\d]/g, '');
        }
    </script>
}



<style>
    .required-star {
        color: red;
    }
</style>
